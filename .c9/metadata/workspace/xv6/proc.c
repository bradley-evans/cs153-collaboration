{"filter":false,"title":"proc.c","tooltip":"/xv6/proc.c","undoManager":{"mark":100,"position":100,"stack":[[{"start":{"row":457,"column":12},"end":{"row":457,"column":13},"action":"remove","lines":["y"],"id":2493}],[{"start":{"row":457,"column":11},"end":{"row":457,"column":12},"action":"remove","lines":["t"],"id":2494}],[{"start":{"row":457,"column":10},"end":{"row":457,"column":11},"action":"remove","lines":["i"],"id":2495}],[{"start":{"row":457,"column":9},"end":{"row":457,"column":10},"action":"remove","lines":["r"],"id":2496}],[{"start":{"row":457,"column":8},"end":{"row":457,"column":9},"action":"remove","lines":["o"],"id":2497}],[{"start":{"row":457,"column":7},"end":{"row":457,"column":8},"action":"remove","lines":["i"],"id":2498}],[{"start":{"row":457,"column":6},"end":{"row":457,"column":7},"action":"remove","lines":["r"],"id":2499}],[{"start":{"row":457,"column":5},"end":{"row":457,"column":6},"action":"remove","lines":["p"],"id":2500}],[{"start":{"row":457,"column":4},"end":{"row":457,"column":5},"action":"remove","lines":[" "],"id":2501}],[{"start":{"row":457,"column":3},"end":{"row":457,"column":4},"action":"remove","lines":["s"],"id":2502}],[{"start":{"row":390,"column":21},"end":{"row":391,"column":0},"action":"insert","lines":["",""],"id":2503},{"start":{"row":391,"column":0},"end":{"row":391,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":427,"column":35},"end":{"row":427,"column":44},"action":"insert","lines":["   // pro"],"id":2504,"ignore":true}],[{"start":{"row":427,"column":44},"end":{"row":428,"column":30},"action":"insert","lines":["c gets changed to","                              "],"id":2505,"ignore":true}],[{"start":{"row":428,"column":30},"end":{"row":428,"column":61},"action":"insert","lines":["        // getprocpriority here"],"id":2506,"ignore":true}],[{"start":{"row":432,"column":35},"end":{"row":432,"column":74},"action":"insert","lines":["   // then compared to current proccess"],"id":2507,"ignore":true}],[{"start":{"row":427,"column":41},"end":{"row":427,"column":45},"action":"remove","lines":["proc"],"id":2508,"ignore":true},{"start":{"row":427,"column":41},"end":{"row":427,"column":49},"action":"insert","lines":["priority"]},{"start":{"row":432,"column":70},"end":{"row":432,"column":74},"action":"remove","lines":["cess"]},{"start":{"row":432,"column":70},"end":{"row":432,"column":73},"action":"insert","lines":["'s "]}],[{"start":{"row":433,"column":31},"end":{"row":433,"column":69},"action":"insert","lines":["       // priority level here, must be"],"id":2509,"ignore":true}],[{"start":{"row":433,"column":69},"end":{"row":434,"column":18},"action":"insert","lines":[" < only","                  "],"id":2510,"ignore":true}],[{"start":{"row":433,"column":76},"end":{"row":434,"column":18},"action":"remove","lines":["","                  "],"id":2511,"ignore":true},{"start":{"row":434,"column":7},"end":{"row":434,"column":43},"action":"insert","lines":["                               // ()"]}],[{"start":{"row":434,"column":41},"end":{"row":434,"column":43},"action":"remove","lines":["()"],"id":2512,"ignore":true},{"start":{"row":434,"column":41},"end":{"row":434,"column":51},"action":"insert","lines":["and not <="]}],[{"start":{"row":419,"column":4},"end":{"row":419,"column":5},"action":"insert","lines":["."],"id":2513}],[{"start":{"row":419,"column":4},"end":{"row":419,"column":5},"action":"remove","lines":["."],"id":2514}],[{"start":{"row":419,"column":4},"end":{"row":419,"column":5},"action":"insert","lines":["/"],"id":2515}],[{"start":{"row":419,"column":5},"end":{"row":419,"column":6},"action":"insert","lines":["*"],"id":2516}],[{"start":{"row":448,"column":26},"end":{"row":448,"column":27},"action":"insert","lines":["*"],"id":2517}],[{"start":{"row":448,"column":27},"end":{"row":448,"column":28},"action":"insert","lines":["/"],"id":2518}],[{"start":{"row":391,"column":2},"end":{"row":391,"column":4},"action":"remove","lines":["  "],"id":2519}],[{"start":{"row":391,"column":0},"end":{"row":391,"column":2},"action":"remove","lines":["  "],"id":2520}],[{"start":{"row":390,"column":21},"end":{"row":391,"column":0},"action":"remove","lines":["",""],"id":2521}],[{"start":{"row":393,"column":5},"end":{"row":393,"column":6},"action":"remove","lines":["*"],"id":2522}],[{"start":{"row":393,"column":5},"end":{"row":393,"column":6},"action":"insert","lines":["/"],"id":2523}],[{"start":{"row":415,"column":6},"end":{"row":415,"column":7},"action":"remove","lines":["/"],"id":2524}],[{"start":{"row":415,"column":5},"end":{"row":415,"column":6},"action":"remove","lines":["*"],"id":2525}],[{"start":{"row":394,"column":43},"end":{"row":394,"column":44},"action":"remove","lines":["y"],"id":2526}],[{"start":{"row":394,"column":42},"end":{"row":394,"column":43},"action":"remove","lines":["t"],"id":2527}],[{"start":{"row":394,"column":41},"end":{"row":394,"column":42},"action":"remove","lines":["i"],"id":2528}],[{"start":{"row":394,"column":40},"end":{"row":394,"column":41},"action":"remove","lines":["r"],"id":2529}],[{"start":{"row":394,"column":39},"end":{"row":394,"column":40},"action":"remove","lines":["o"],"id":2530}],[{"start":{"row":394,"column":38},"end":{"row":394,"column":39},"action":"remove","lines":["i"],"id":2531}],[{"start":{"row":394,"column":37},"end":{"row":394,"column":38},"action":"remove","lines":["r"],"id":2532}],[{"start":{"row":394,"column":36},"end":{"row":394,"column":37},"action":"remove","lines":["p"],"id":2533}],[{"start":{"row":394,"column":35},"end":{"row":394,"column":36},"action":"remove","lines":["x"],"id":2534}],[{"start":{"row":394,"column":34},"end":{"row":394,"column":35},"action":"remove","lines":["a"],"id":2535}],[{"start":{"row":394,"column":33},"end":{"row":394,"column":34},"action":"remove","lines":["m"],"id":2536}],[{"start":{"row":394,"column":33},"end":{"row":394,"column":34},"action":"insert","lines":["6"],"id":2537}],[{"start":{"row":394,"column":34},"end":{"row":394,"column":35},"action":"insert","lines":["5"],"id":2538}],[{"start":{"row":393,"column":5},"end":{"row":393,"column":6},"action":"remove","lines":["/"],"id":2539}],[{"start":{"row":393,"column":5},"end":{"row":393,"column":6},"action":"insert","lines":["*"],"id":2540}],[{"start":{"row":415,"column":5},"end":{"row":415,"column":6},"action":"insert","lines":["*"],"id":2541}],[{"start":{"row":415,"column":6},"end":{"row":415,"column":7},"action":"insert","lines":["/"],"id":2542}],[{"start":{"row":418,"column":5},"end":{"row":418,"column":6},"action":"remove","lines":["*"],"id":2543}],[{"start":{"row":418,"column":4},"end":{"row":418,"column":5},"action":"remove","lines":["/"],"id":2544}],[{"start":{"row":447,"column":27},"end":{"row":447,"column":28},"action":"remove","lines":["/"],"id":2545}],[{"start":{"row":447,"column":26},"end":{"row":447,"column":27},"action":"remove","lines":["*"],"id":2546}],[{"start":{"row":428,"column":6},"end":{"row":428,"column":16},"action":"insert","lines":["printf(\"\")"],"id":2547,"ignore":true}],[{"start":{"row":428,"column":14},"end":{"row":428,"column":32},"action":"insert","lines":["CURRENT PRIORITY: "],"id":2548,"ignore":true},{"start":{"row":428,"column":34},"end":{"row":429,"column":6},"action":"insert","lines":["","      "]}],[{"start":{"row":429,"column":6},"end":{"row":429,"column":16},"action":"insert","lines":["printf(\"\")"],"id":2549,"ignore":true}],[{"start":{"row":428,"column":14},"end":{"row":428,"column":16},"action":"insert","lines":["\\n"],"id":2550,"ignore":true}],[{"start":{"row":429,"column":14},"end":{"row":429,"column":16},"action":"insert","lines":["%D"],"id":2551,"ignore":true}],[{"start":{"row":429,"column":15},"end":{"row":429,"column":16},"action":"remove","lines":["D"],"id":2552,"ignore":true},{"start":{"row":429,"column":15},"end":{"row":429,"column":16},"action":"insert","lines":["d"]},{"start":{"row":429,"column":17},"end":{"row":429,"column":18},"action":"insert","lines":[" "]}],[{"start":{"row":429,"column":17},"end":{"row":429,"column":18},"action":"remove","lines":[" "],"id":2553,"ignore":true},{"start":{"row":429,"column":17},"end":{"row":429,"column":26},"action":"insert","lines":[",priority"]}],[{"start":{"row":430,"column":28},"end":{"row":431,"column":18},"action":"insert","lines":["","      pritnf(\"\\n\")"],"id":2554,"ignore":true}],[{"start":{"row":435,"column":6},"end":{"row":437,"column":6},"action":"insert","lines":["","        ","      "],"id":2555,"ignore":true}],[{"start":{"row":436,"column":8},"end":{"row":482,"column":375},"action":"insert","lines":["In addition, a priority variable was added to to struct proc to give variables a means of storing a priority code.","The processes need a way to change priority. A mutator is required. In proc.c this is defined as setpriority:","int","setpriority(int num)","{","  if (num < 0) {","    num = 0;","  } else if (num > 63) {","    num = 63;","  }s priority","  ","  proc->priority = num;","  ","  return 0;","}","This is tied to a setpriority system call, added into the system in a similar way to the earlier hello call.","Also, a getprocpriority function will return the current seniormost priority level.","int","getprocpriority(void)","{","  struct proc *p;","  int priority = 65;","  ","  // go through ptable","  acquire(&ptable.lock);","  for (p = ptable.proc; p < &ptable.proc[NPROC]; p++) {","    // look for runnable process","    if(p->state != RUNNABLE) {","          continue;","    }","    ","    if(priority == 0) {","      priority = p->priority;","    } else {","      if (p->priority < priority) {","        priority = p->priority;","      }","    }","  }","  ","  release(&ptable.lock);","  ","  return priority;","}","Priority Donation and Inheritence","A problem with priority schedulers is deadlock, where lower-priority processes do not yield resources to a higher-priority process. A way to mitigate this is via priority donation and inheritence. If a higher priority task (H) attempts to access resource in use by a lower priority task (L), the lower priority task \"inherits\" a higher priority so that it can complete execution of some critical, uninterruptable portion of its programming. This prevents L from being pre-empted by a medium priority task M, which might then block H from executing.","To make this happen, you could use the setpriority mutator whenever a task enters the queue below a lower priority task. setpriority would manually change the lower priority's priority value to be equal to that of the high-priority task. When the high-priority task is allowed to execute, it can use setpriority to return the low-priority task to its original priority level."],"id":2556,"ignore":true}],[{"start":{"row":435,"column":6},"end":{"row":438,"column":18},"action":"insert","lines":["        printf(\"\\nCURRENT PRIORITY: \")","      printf(\"%d\",priority)","      acquire(&ptable.lock);","      pritnf(\"\\n\")"],"id":2557,"ignore":true},{"start":{"row":439,"column":8},"end":{"row":485,"column":375},"action":"remove","lines":["In addition, a priority variable was added to to struct proc to give variables a means of storing a priority code.","The processes need a way to change priority. A mutator is required. In proc.c this is defined as setpriority:","int","setpriority(int num)","{","  if (num < 0) {","    num = 0;","  } else if (num > 63) {","    num = 63;","  }s priority","  ","  proc->priority = num;","  ","  return 0;","}","This is tied to a setpriority system call, added into the system in a similar way to the earlier hello call.","Also, a getprocpriority function will return the current seniormost priority level.","int","getprocpriority(void)","{","  struct proc *p;","  int priority = 65;","  ","  // go through ptable","  acquire(&ptable.lock);","  for (p = ptable.proc; p < &ptable.proc[NPROC]; p++) {","    // look for runnable process","    if(p->state != RUNNABLE) {","          continue;","    }","    ","    if(priority == 0) {","      priority = p->priority;","    } else {","      if (p->priority < priority) {","        priority = p->priority;","      }","    }","  }","  ","  release(&ptable.lock);","  ","  return priority;","}","Priority Donation and Inheritence","A problem with priority schedulers is deadlock, where lower-priority processes do not yield resources to a higher-priority process. A way to mitigate this is via priority donation and inheritence. If a higher priority task (H) attempts to access resource in use by a lower priority task (L), the lower priority task \"inherits\" a higher priority so that it can complete execution of some critical, uninterruptable portion of its programming. This prevents L from being pre-empted by a medium priority task M, which might then block H from executing.","To make this happen, you could use the setpriority mutator whenever a task enters the queue below a lower priority task. setpriority would manually change the lower priority's priority value to be equal to that of the high-priority task. When the high-priority task is allowed to execute, it can use setpriority to return the low-priority task to its original priority level."]}],[{"start":{"row":435,"column":0},"end":{"row":435,"column":2},"action":"insert","lines":["  "],"id":2558,"ignore":true},{"start":{"row":435,"column":8},"end":{"row":435,"column":16},"action":"remove","lines":["        "]},{"start":{"row":436,"column":0},"end":{"row":436,"column":2},"action":"insert","lines":["  "]},{"start":{"row":437,"column":0},"end":{"row":437,"column":2},"action":"insert","lines":["  "]},{"start":{"row":438,"column":0},"end":{"row":438,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":428,"column":36},"end":{"row":428,"column":37},"action":"insert","lines":[";"],"id":2559,"ignore":true},{"start":{"row":435,"column":38},"end":{"row":435,"column":39},"action":"insert","lines":[";"]},{"start":{"row":436,"column":29},"end":{"row":436,"column":30},"action":"insert","lines":[";"]}],[{"start":{"row":429,"column":27},"end":{"row":429,"column":28},"action":"insert","lines":[";"],"id":2560,"ignore":true},{"start":{"row":431,"column":9},"end":{"row":431,"column":11},"action":"remove","lines":["tn"]},{"start":{"row":431,"column":9},"end":{"row":431,"column":11},"action":"insert","lines":["nt"]},{"start":{"row":431,"column":18},"end":{"row":431,"column":19},"action":"insert","lines":[";"]}],[{"start":{"row":438,"column":20},"end":{"row":438,"column":21},"action":"insert","lines":[";"],"id":2561,"ignore":true}],[{"start":{"row":438,"column":11},"end":{"row":438,"column":12},"action":"remove","lines":["t"],"id":2562,"ignore":true},{"start":{"row":438,"column":12},"end":{"row":438,"column":13},"action":"insert","lines":["t"]}],[{"start":{"row":430,"column":6},"end":{"row":431,"column":0},"action":"insert","lines":["",""],"id":2563},{"start":{"row":431,"column":0},"end":{"row":431,"column":6},"action":"insert","lines":["      "]}],[{"start":{"row":432,"column":6},"end":{"row":433,"column":0},"action":"insert","lines":["",""],"id":2564},{"start":{"row":433,"column":0},"end":{"row":433,"column":6},"action":"insert","lines":["      "]}],[{"start":{"row":442,"column":10},"end":{"row":442,"column":12},"action":"remove","lines":["  "],"id":2565}],[{"start":{"row":442,"column":8},"end":{"row":442,"column":10},"action":"remove","lines":["  "],"id":2566}],[{"start":{"row":442,"column":7},"end":{"row":442,"column":8},"action":"remove","lines":[" "],"id":2567}],[{"start":{"row":437,"column":8},"end":{"row":438,"column":0},"action":"insert","lines":["",""],"id":2573},{"start":{"row":438,"column":0},"end":{"row":438,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":440,"column":8},"end":{"row":441,"column":0},"action":"insert","lines":["",""],"id":2574},{"start":{"row":441,"column":0},"end":{"row":441,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":442,"column":8},"end":{"row":443,"column":0},"action":"insert","lines":["",""],"id":2575},{"start":{"row":443,"column":0},"end":{"row":443,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":7,"column":21},"end":{"row":9,"column":18},"action":"insert","lines":["","","#include \"stdio.c\""],"id":2576,"ignore":true}],[{"start":{"row":9,"column":16},"end":{"row":9,"column":17},"action":"remove","lines":["c"],"id":2577,"ignore":true},{"start":{"row":9,"column":16},"end":{"row":9,"column":17},"action":"insert","lines":["h"]}],[{"start":{"row":443,"column":8},"end":{"row":443,"column":30},"action":"remove","lines":["acquire(&ptable.lock);"],"id":2578}],[{"start":{"row":443,"column":8},"end":{"row":444,"column":8},"action":"remove","lines":["","        "],"id":2579}],[{"start":{"row":443,"column":8},"end":{"row":444,"column":0},"action":"remove","lines":["",""],"id":2580}],[{"start":{"row":443,"column":8},"end":{"row":443,"column":10},"action":"remove","lines":["  "],"id":2581}],[{"start":{"row":443,"column":8},"end":{"row":443,"column":10},"action":"remove","lines":["  "],"id":2582}],[{"start":{"row":443,"column":8},"end":{"row":443,"column":10},"action":"remove","lines":["  "],"id":2583}],[{"start":{"row":443,"column":8},"end":{"row":443,"column":10},"action":"remove","lines":["  "],"id":2584}],[{"start":{"row":427,"column":6},"end":{"row":428,"column":0},"action":"remove","lines":["",""],"id":2585}],[{"start":{"row":427,"column":6},"end":{"row":427,"column":8},"action":"remove","lines":["  "],"id":2586}],[{"start":{"row":427,"column":6},"end":{"row":427,"column":8},"action":"remove","lines":["  "],"id":2587}],[{"start":{"row":427,"column":6},"end":{"row":427,"column":8},"action":"remove","lines":["  "],"id":2588}],[{"start":{"row":427,"column":6},"end":{"row":427,"column":7},"action":"remove","lines":["p"],"id":2589}],[{"start":{"row":427,"column":6},"end":{"row":427,"column":7},"action":"insert","lines":["p"],"id":2590}],[{"start":{"row":8,"column":0},"end":{"row":10,"column":0},"action":"remove","lines":["","#include \"stdio.h\"",""],"id":2591,"ignore":true}],[{"start":{"row":427,"column":6},"end":{"row":427,"column":7},"action":"insert","lines":["c"],"id":2599,"ignore":true},{"start":{"row":428,"column":6},"end":{"row":428,"column":7},"action":"insert","lines":["c"]},{"start":{"row":432,"column":6},"end":{"row":432,"column":7},"action":"insert","lines":["c"]}],[{"start":{"row":437,"column":8},"end":{"row":437,"column":9},"action":"insert","lines":["c"],"id":2603,"ignore":true},{"start":{"row":438,"column":8},"end":{"row":438,"column":9},"action":"insert","lines":["c"]}],[{"start":{"row":440,"column":8},"end":{"row":440,"column":9},"action":"insert","lines":["c"],"id":2604,"ignore":true}],[{"start":{"row":427,"column":17},"end":{"row":427,"column":23},"action":"insert","lines":["(head)"],"id":2605,"ignore":true}],[{"start":{"row":437,"column":19},"end":{"row":437,"column":23},"action":"insert","lines":["(if)"],"id":2606,"ignore":true}],[{"start":{"row":427,"column":18},"end":{"row":427,"column":22},"action":"remove","lines":["head"],"id":2607,"ignore":true},{"start":{"row":427,"column":18},"end":{"row":427,"column":31},"action":"insert","lines":["after getproc"]}],[{"start":{"row":426,"column":61},"end":{"row":429,"column":6},"action":"remove","lines":["","      cprintf(\"\\n(after getproc)CURRENT PRIORITY: \");","      cprintf(\"%d\",priority);","      "],"id":2608,"ignore":true},{"start":{"row":428,"column":6},"end":{"row":429,"column":20},"action":"remove","lines":["","      cprintf(\"\\n\");"]},{"start":{"row":432,"column":8},"end":{"row":436,"column":22},"action":"remove","lines":["","        cprintf(\"\\n(if)CURRENT PRIORITY: \");","        cprintf(\"%d\",priority);","        ","        cprintf(\"\\n\");"]}]]},"ace":{"folds":[{"start":{"row":9,"column":8},"end":{"row":12,"column":0},"placeholder":"..."},{"start":{"row":25,"column":1},"end":{"row":27,"column":0},"placeholder":"..."},{"start":{"row":36,"column":1},"end":{"row":78,"column":0},"placeholder":"..."},{"start":{"row":84,"column":1},"end":{"row":116,"column":0},"placeholder":"..."},{"start":{"row":122,"column":1},"end":{"row":136,"column":0},"placeholder":"..."},{"start":{"row":143,"column":1},"end":{"row":182,"column":0},"placeholder":"..."},{"start":{"row":192,"column":1},"end":{"row":233,"column":0},"placeholder":"..."},{"start":{"row":239,"column":1},"end":{"row":282,"column":0},"placeholder":"..."},{"start":{"row":394,"column":50},"end":{"row":415,"column":4},"placeholder":"..."},{"start":{"row":475,"column":1},"end":{"row":489,"column":0},"placeholder":"..."},{"start":{"row":494,"column":1},"end":{"row":499,"column":0},"placeholder":"..."},{"start":{"row":505,"column":1},"end":{"row":520,"column":0},"placeholder":"..."},{"start":{"row":526,"column":1},"end":{"row":557,"column":0},"placeholder":"..."},{"start":{"row":564,"column":1},"end":{"row":570,"column":0},"placeholder":"..."},{"start":{"row":575,"column":1},"end":{"row":579,"column":0},"placeholder":"..."},{"start":{"row":586,"column":1},"end":{"row":602,"column":0},"placeholder":"..."},{"start":{"row":610,"column":1},"end":{"row":639,"column":0},"placeholder":"..."},{"start":{"row":642,"column":13},"end":{"row":644,"column":0},"placeholder":"..."}],"scrolltop":599.888916015625,"scrollleft":0,"selection":{"start":{"row":420,"column":16},"end":{"row":420,"column":16},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":119,"state":"start","mode":"ace/mode/c_cpp"}},"timestamp":1493618213013,"hash":"6b639c97e9101c91f9b8fe976197c8e1cf0db18b"}