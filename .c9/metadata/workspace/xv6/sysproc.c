{"changed":true,"filter":false,"title":"sysproc.c","tooltip":"/xv6/sysproc.c","ace":{"folds":[],"scrolltop":1264,"scrollleft":0,"selection":{"start":{"row":92,"column":37},"end":{"row":92,"column":37},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":488,"mode":"ace/mode/c_cpp"}},"value":"#include \"types.h\"\n#include \"x86.h\"\n#include \"defs.h\"\n#include \"date.h\"\n#include \"param.h\"\n#include \"memlayout.h\"\n#include \"mmu.h\"\n#include \"proc.h\"\n\nint\nsys_fork(void)\n{\n  return fork();\n}\n\nint\nsys_exit(void)\n{\n  exit();\n  return 0;  // not reached\n}\n\nint\nsys_wait(void)\n{\n  return wait();\n}\n\nint\nsys_kill(void)\n{\n  int pid;\n\n  if(argint(0, &pid) < 0)\n    return -1;\n  return kill(pid);\n}\n\nint\nsys_getpid(void)\n{\n  return proc->pid;\n}\n\nint\nsys_sbrk(void)\n{\n  int addr;\n  int n;\n\n  if(argint(0, &n) < 0)\n    return -1;\n  addr = proc->sz;\n  if(growproc(n) < 0)\n    return -1;\n  return addr;\n}\n\nint\nsys_sleep(void)\n{\n  int n;\n  uint ticks0;\n\n  if(argint(0, &n) < 0)\n    return -1;\n  acquire(&tickslock);\n  ticks0 = ticks;\n  while(ticks - ticks0 < n){\n    if(proc->killed){\n      release(&tickslock);\n      return -1;\n    }\n    sleep(&ticks, &tickslock);\n  }\n  release(&tickslock);\n  return 0;\n}\n\n// return how many clock tick interrupts have occurred\n// since start.\nint\nsys_uptime(void)\n{\n  uint xticks;\n\n  acquire(&tickslock);\n  xticks = ticks;\n  release(&tickslock);\n  return xticks;\n}\n\nint sys_v2p(void) {     // MOD: Lab 2\n  int virtual=0;\n  int *physical;\n  \n  if (argint(0, &virtual) < 0) {\n    return -1;\n  }\n\n  if (argptr(1, (char**)&physical, sizeof(physical)) < 0) {\n    return -1;\n  }\n  \n  v2p(virtual,physical);\n  return virtual;\n\n}","undoManager":{"mark":1,"position":1,"stack":[[{"start":{"row":91,"column":0},"end":{"row":92,"column":0},"action":"insert","lines":["",""],"id":2}],[{"start":{"row":92,"column":0},"end":{"row":107,"column":1},"action":"insert","lines":["int sys_v2p(void) {     // MOD: Lab 2","  int virtual=0;","  int *physical;","  ","  if (argint(0, &virtual) < 0) {","    return -1;","  }","","  if (argptr(1, (char**)&physical, sizeof(physical)) < 0) {","    return -1;","  }","  ","  v2p(virtual,physical);","  return virtual;","","}"],"id":3}],[{"start":{"row":92,"column":18},"end":{"row":93,"column":0},"action":"insert","lines":["",""],"id":4}]]},"timestamp":1494967961052}